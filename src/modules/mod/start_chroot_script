#!/usr/bin/env bash
# <Script Name>
# <Description what this module does>
# Written by <Author>
# GPL V3
########


# Source error handling, leave this in place
set -x
set -e

source /common.sh
install_cleanup_trap

gitclone JACK_REPO jack2

pushd "/home/${BASE_USER}/jack2"
./waf configure
./waf build
sudo ./waf install
popd

gitclone BROWSEPY_REPO browsepy

pushd "/home/${BASE_USER}/browsepy"
sudo pip3 install ./
popd

gitclone MODHOST_REPO mod-host

pushd "/home/${BASE_USER}/mod-host"
make
sudo make install
popd

gitclone MODUI_REPO mod-ui

pushd "/home/${BASE_USER}/mod-ui"
chmod +x setup.py
cd utils
make
cd ..
sudo ./setup.py install
cp -r default.pedalboard /home/${BASE_USER}/data/.pedalboards
popd

gitclone MODMIDI_REPO mod-midi-merger

pushd "/home/${BASE_USER}/mod-midi-merger"
mkdir build && cd build
cmake ..
make
sudo make install
popd

gitclone AMIDI_REPO amidithru

pushd "/home/${BASE_USER}/amidithru"
sed -i 's/CXX=g++.*/CXX=g++/' Makefile
sudo make install
popd

gitclone TOUCHOSC_REPO touchosc2midi

pushd "/home/${BASE_USER}/touchosc2midi"
sudo pip3 install ./
popd

sudo adduser --no-create-home --system --group jack
sudo adduser ${BASE_USER} jack --quiet
sudo adduser root jack --quiet
sudo adduser jack audio --quiet